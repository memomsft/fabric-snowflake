-- IoT Demo Database for Fabric Mirroring Workshop

CREATE OR REPLACE DATABASE FABRIC_MIRROR_DEMO;
USE DATABASE FABRIC_MIRROR_DEMO;
CREATE OR REPLACE SCHEMA IOT;

-- Devices table
CREATE OR REPLACE TABLE IOT.DEVICES (
    DEVICE_ID INT AUTOINCREMENT PRIMARY KEY,
    DEVICE_NAME STRING,
    DEVICE_TYPE STRING,
    INSTALLED_ON DATE
);

-- Locations table
CREATE OR REPLACE TABLE IOT.LOCATIONS (
    LOCATION_ID INT AUTOINCREMENT PRIMARY KEY,
    LOCATION_NAME STRING,
    COUNTRY STRING
);

-- Readings table
CREATE OR REPLACE TABLE IOT.READINGS (
    READING_ID INT AUTOINCREMENT PRIMARY KEY,
    DEVICE_ID INT,
    LOCATION_ID INT,
    READING_TS TIMESTAMP,
    TEMPERATURE DOUBLE,
    HUMIDITY DOUBLE
);

-- Sample data
INSERT INTO IOT.DEVICES (DEVICE_NAME, DEVICE_TYPE, INSTALLED_ON) VALUES
('ThermoX-01', 'Thermostat', '2024-12-01'),
('ThermoX-02', 'Thermostat', '2024-12-05'),
('HumidX-01', 'Humidity Sensor', '2024-12-10');

INSERT INTO IOT.LOCATIONS (LOCATION_NAME, COUNTRY) VALUES
('Data Center A', 'US'),
('Factory B', 'MX'),
('Warehouse C', 'CA');

INSERT INTO IOT.READINGS (DEVICE_ID, LOCATION_ID, READING_TS, TEMPERATURE, HUMIDITY) VALUES
(1, 1, '2025-01-01 08:00:00', 22.5, 45.0),
(1, 1, '2025-01-01 12:00:00', 23.0, 46.2),
(2, 2, '2025-01-02 09:15:00', 28.1, 40.5),
(3, 3, '2025-01-02 10:00:00', 20.5, 60.0),
(3, 3, '2025-01-02 14:00:00', 21.0, 61.2);
